---
- name: Install Apigee component for version {{ opdk_version }} or greater with proxy - {{ profile }}
  command: '{{ apigee_setup }} -p {{ profile }} -f {{ opdk_installation_config_file }}'
  when: opdk_version | version_compare('4.16.01', '>=')
  environment:
    http_proxy: "{{ http_proxy }}"
    https_proxy: "{{ https_proxy }}"
    no_proxy: "{{ no_proxy }}"
  register: result

- name: Installation with proxy failed
  fail:
    msg: "Apigee Component failed"
  when: result.failed is defined and result.failed | bool

- name: Wait for ready with no proxy
  command: '{{ apigee_all }} wait_for_ready'
  when: validate_ready | default(true)

