---
# tasks file for apigee-opdk-setup-component
- name: Cache attributes attributes
  tags: ['cache']
  include_tasks: "cache.yml"

- block:
  - name: Include Apigee setup commands
    include_tasks: setup-apigee-component.yml

  rescue:
    - name: Rescue for Apigee component installation
      include_tasks: "rescue.yml"

- name: Wait for ready
  become: yes
  command: '{{ apigee_all }} wait_for_ready'
  when: validate_ready | default(true)
  environment:
    http_proxy: "{{ http_proxy | default('') }}"
    https_proxy: "{{ https_proxy | default('') }}"
    no_proxy: "{{ no_proxy | default('') }}"

- name: Validate component status
  become: yes
  command: '{{ apigee_all }} status'
  environment:
    http_proxy: "{{ http_proxy | default('') }}"
    https_proxy: "{{ https_proxy | default('') }}"
    no_proxy: "{{ no_proxy | default('') }}"

