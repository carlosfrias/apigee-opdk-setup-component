---
# tasks file for apigee-opdk-setup-component
- block:

  - name: Install Apigee component for version {{ opdk_version }} or greater - {{ profile }}
    shell: '{{ apigee_setup }} -p {{ profile }} -f {{ opdk_installation_config_file }}'
    when: opdk_version | version_compare('4.16.01', '>=')

  - name: Small time delay for component boot, change with -e component_start_delay=
    pause:
      seconds: '{{ component_start_delay | default(1) }}'

  - name: Validating that component started
    shell: '{{ apigee_all }} status'
    when: opdk_version | version_compare('4.16.01', '>=')

  rescue:

    - name: Checking to see if failure was real by starting the components
      shell: '{{ apigee_all }} start'
      when: opdk_version | version_compare('4.16.01', '>=')

    - name: Small time delay for component boot, change with -e component_start_delay=
      pause:
        seconds: '{{ component_start_delay | default(1) }}'

    - name: Validating that component started
      shell: '{{ apigee_all }} status'
      when: opdk_version | version_compare('4.16.01', '>=')
